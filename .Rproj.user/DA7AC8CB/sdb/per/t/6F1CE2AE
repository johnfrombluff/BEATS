{
    "contents" : "\\documentclass[a4paper]{article}\n\\usepackage{longtable,booktabs,mathptmx,varioref,hyperref}\n\n\\hypersetup{colorlinks=TRUE,linkcolor=blue}\n\\title{Model search}\n\\author{John Williams}\n\n\\setcounter{secnumdepth}{9}\n\\setcounter{tocdepth}{9}\n\\newcommand{\\R}{\\textbf{\\sffamily R}}\n\n\\begin{document}\n\\maketitle\n\\tableofcontents\n\\thispagestyle{empty}\n\\par\n\\vspace{1em}\nTODO:\n\\begin{itemize}\n\\item Reconsider which variables  belong in which category of Panter et al.\n\\item Figure out why correlates that are significant in the multivariate model aren't significant in univariate models.\n\\end{itemize}\n\n<<label=R-setup, echo=FALSE, include=FALSE, cache=FALSE>>=\n# bibliography: /home/john/Dropbox/Writing/bib/all-refs.bib\nrequire( ggplot2 )\nrequire( scales )\nrequire( Gmisc )\nrequire( knitr )\nrequire( JMisc )\nrequire( xtable )\nrequire( dplyr )\nrequire( haven )\n# Evaluate the figure caption after the plot\nknitr::opts_knit$set(eval.after='fig.cap')\n\n# Use the table counter that the htmlTable() provides\noptions(table_counter = TRUE)\n\n# Use the figCapNo() with roman letters\noptions(fig_caption_no_roman = TRUE)\n\n#theme_set( theme_gray( base_size = 10 ))\n#theme_update( legend.key.width = unit( 3,\"line\") )\noptions(width=80)\noptions(\"show.signif.stars\"=F)\n\n## set global chunk options\nopts_chunk$set(echo=FALSE,\n               cache=TRUE,\n               dpi=96,\n               fig.height=5,\n               fig.width=7,\n               prompt=F,\n               tidy=T,\n               highlight=T,\n               dev=\"png\",\n               dev.args=list(type=\"cairo\"),\n               fig.align='center',\n               fig.show='hold',\n               par=TRUE,\n               comment=NA,\n               background=\"wheat\",\n               prompt=FALSE,\n               cache.extra = tools::md5sum('../data-setup.R'),\n               warning=FALSE,\n               message=FALSE)\n\ninfo   <- sessionInfo()\nr_ver  <- paste(info$R.version$major, info$R.version$minor, sep=\".\")\nbarcol <- \"wheat\"\n@\n\n\\clearpage\n\\section*{Introduction}\nThis document contains the results of the ``univariate'' models, i.e. each\npotential covariate, with interaction terms for each of the three moderators.\nThe classification of variables into the categories defined by Panter et al. is\nshown in Table~\\vref{tab:variables-in-slots}.\n\nVariables that we have that don't fit into the categories defined by Panter et\nal. include:\n\n\\begin{itemize}\n\\item some household characteristics (e.g. number of siblings)\n\\item regwalk, i.e. the frequency of using walking for general mobility\n\\end{itemize}\n\nThe \\R\\ code below is just to show which data file is being used. All\nanalyses were performed using \\R\\ version~\\Sexpr{r_ver}, with package \\textsf{rms}\nversion~\\Sexpr{packageVersion(\"rms\")} for logistic regression modelling.\n\n<<label=\"read-data\", echo=2:4, size=\"small\", prompt=FALSE>>=\ndir_n  <- \"/home/john/Dropbox/Research/Collaboration/BEATS/John/W2S\"\nfile_n <- \"BEATS_SS_ForWalk2School_150507.sav\"\ndat <- read_spss( fname(dir_n, file_n)  )\nrm(dir_n, file_n)\n@\n\n<<label=data-setup, results='hide'>>=\nsource( \"../data-setup-W2S.R\")\nrequire( rms )\nats.ddist <- datadist(dat.ats)\noptions(datadist=\"ats.ddist\")\nattach(dat.ats)\n@\n\n<<make-visible, cache=FALSE>>=\nattach(dat.ats)\n@\n\nThe correlates are being examined in this way (rather than entering all variables\nat once) beause of numerical problems with the estimation algorithm. But even\nwith this reduced approach, not all moderators could be tested simultaneously.\nThese problems are noted in the rightmost column in the table below.\n\n\\begin{center}\n\\renewcommand\\arraystretch{0.9}\n\\small\n\\begin{tabular}{llcccccccc}\n\\toprule\nBlock                     & Variable & Main effect & \\multicolumn{3}{c}{Moderators} & All\\\\\n\\cmidrule(r){4-6}\n                          &             &     & Distance & Age & Sex  &     \\\\\n\\midrule\n\\multicolumn{2}{l}{1. \\textbf{Physical environment} }   \\\\\n1.1 Neighbourhood         & nothing?      &     &     &     &     &     \\\\\n1.2 Destination           & nothing?      &     &     &     &     &     \\\\\n1.3 Route                 & distance      &  y  &     &     &     &     \\\\\n2. \\textbf{Individual factors} \\\\\n\\multicolumn{2}{l}{2.1  \\textit{Parental factors}}   \\\\\n2.1.1 Characteristics     & nothing?      &     &     &     &     &     \\\\\n2.1.2 Attitudes*          & parents\\_say  &  n  &  n  &  n  &  n  &  n  \\\\\n                          & parents\\_safe &  y  &  n  &  n  &  y  &  y  \\\\\n                          & school\\_says  &  n  &  n  &  n  &  n  &  y  \\\\\n\\multicolumn{2}{l}{2.2 \\textit{Perceptions of environmental factors}} \\\\\n2.2.1 Parental perceptions& nothing \\\\\n2.2.2  Youth perceptions* & onway         &  n  &  n  &  n  &  n  &  y  \\\\\n                          & time          &  n  &  n  &  n  &  n  &  y  \\\\\n                          & stuff         &  n  &  y  &  n  &  n  &  n  \\\\\n                          & weather       &  n  &  n  &  n  &  n  &  n  \\\\\n                          & hills         &  n  &  y  &  n  &  n  &  n  \\\\\n                          & boring\\_r     &  n  &  n  &  n  &  n  &  y  \\\\\n                          & NEStConnect   &  n  &  n  &  n  &  n  &  n  \\\\\n                          & NGEsthetics   &  y  &  y  &  n  &  y  &  n  \\\\\n\\multicolumn{2}{l}{2.3 \\textit{Youth factors}} \\\\\n2.3.1 Characteristics     & BMI           &  y  &     &     &     &     \\\\\n2.3.2 Attitudes*          & interesting   &  n  &  y  &  n  &  y  &  n  \\\\\n                          & pleasant      &  y  &  n  &  n  &  y  &  n  \\\\\n                          & boring        &  n  &  y  &  n  &  n  &  y  \\\\\n                          & healthy       &  n  &  n  &  n  &  n  &  n  \\\\\n                          & useful        &  y  &  n  &  n  &  y  &  n  \\\\\n                          & safe          &  y  &  n  &  n  &  n  &  n  \\\\\n                          & exercise      &  n  &  n  &  n  &  n  &  n  \\\\\n                          & schedule      &  n  &  n  &  n  &  n  &  y  \\\\\n                          & planning      &  n  &  n  &  n  &  n  &  y  \\\\\n                          & sweaty        &  n  &  n  &  n  &  n  &  y  \\\\\n                          & unsafe        &  n  &  n  &  n  &  n  &  y  \\\\\n                          & tired         &  n  &  n  &  n  &  n  &  y  \\\\\n                          & desire        &  y  &  n  &  y  &  n  &  y  \\\\\n                          & confident     &  n  &  n  &  n  &  n  &  n  \\\\\n                          & intention     &  n  &  n  &  n  &  n  &  n  \\\\\n                          & cool          &  n  &  n  &  n  &  n  &  y  \\\\\n                          & friends\\_dont &  n  &  n  &  n  &  n  &  y  \\\\\n                          & TSlike        &  n  &  n  &  n  &  n  &  y  \\\\\n\\multicolumn{2}{l}{2.4 \\textit{The decision process*} } \\\\\n                          & whodecides    &  n  &  n  &  n  &  n  &  y  \\\\\n                          & control       &  y  &  n  &  n  &  y  &  y  \\\\\n3  \\textbf{External factors}       & \\emph{none}   \\\\\n4  Other                  & regwalk       &  y  \\\\\n                          & schiclose     &  n  \\\\\n\\bottomrule\n\\end{tabular}\n\\end{center}\nSo, the following moderated factors will be included:\n\n\\begin{enumerate}\n\\item Youth attitudes: parents\\_safe*Sex,\n  stuff*Dist, hills*Dist,\n  NGEsthetics*Dist, NGEsthetics*Sex,\n  weather*Dist,\n  interesting*Dist, interesting*Sex,\n  pleasant*Sex,\n  boring*Dist,\n  useful*Sex,\n  desire*Age\n\\item Other: parents\\_safe*Sex, control*Sex\n\\end{enumerate}\n\nThe results of the multivariate models can be found in\nSection~\\vref{sec:multivariate}.\n\n%\\begin{table}[ht]\n%\\scriptsize\n<<list-labels, results='asis'>>=\nvars <- data.frame( name=names(dat.ats), label=label(dat.ats), slot=\"\", desc=\"\", mod=\"\", done=\"\", stringsAsFactors = FALSE)\nvars[\"BMI_f\",           c(\"slot\", \"desc\", \"mod\")] <- c(\"2.3.1\", \"Youth characteristics\", \"\")\nvars[\"HMcars\",          c(\"slot\", \"desc\", \"mod\")] <- c(\"2.1.1\", \"Parent characteristics\", \"\")\nvars[\"NZDepCat3\",       c(\"slot\", \"desc\", \"mod\")] <- c(\"1.1\",   \"Attributes of neighbourhood\", \"\")\nvars[\"PAGuideQ\",        c(\"slot\", \"desc\", \"mod\")] <- c(\"2.3.1\", \"Youth characteristics\", \"\")\nvars[\"ScrGuide\",        c(\"slot\", \"desc\", \"mod\")] <- c(\"2.3.1\", \"Youth characteristics\", \"\")\nvars[\"eth3\",            c(\"slot\", \"desc\", \"mod\")] <- c(\"2.3.1\", \"Youth characteristics\", \"\")\nvars[\"whodecides\",      c(\"slot\", \"desc\", \"mod\")] <- c(\"2.4\",   \"Decision process\", \"Y\")\nvars[\"schiclose\",       c(\"slot\", \"desc\", \"mod\")] <- c(\"4\",     \"Other\", \"?\")\nvars[\"closest\",         c(\"slot\", \"desc\", \"mod\")] <- c(\"1.3\",   \"Attributes of route\", \"\")\nvars[\"siblings\",        c(\"slot\", \"desc\", \"mod\")] <- c(\"2.1\",   \"Parent characteristics\", \"\")\nvars[\"school_decile_n\", c(\"slot\", \"desc\", \"mod\")] <- c(\"1.2\",   \"Attributes of destination\", \"\")\nvars[\"regwalk\",         c(\"slot\", \"desc\", \"mod\")] <- c(\"4\",   \"Other\", \"?\")\nvars[c(17:36,41:43,44, 57),    c(\"slot\", \"desc\", \"mod\")] <- c(rep(\"2.3.2\", 25), rep(\"Youth attitudes\",         25), rep(\"Y\", 25) )\nvars[c(36:38,60),       c(\"slot\", \"desc\", \"mod\")] <- c(rep(\"2.1.1\",  4), rep(\"Parental characteristics\", 4), rep(\"\", 4 ) )\nvars[c(39:40),          c(\"slot\", \"desc\", \"mod\")] <- c(rep(\"2.1.2\",  2), rep(\"Parental attitudes\",       2), rep(\"Y\", 2 ) )\nvars[c(45:47, 49:50),   c(\"slot\", \"desc\", \"mod\")] <- c(rep(\"2.2.2\",  5), rep(\"Youth perceptions\",        5), rep(\"Y\", 5 ) )\nvars[\"control\",         c(\"slot\", \"desc\", \"mod\")] <- c(\"2.4\",   \"Decision process\", \"Y\")\nvars[\"parents_say\",  \"done\"] <- \"y\"\nvars[\"school_says\",  \"done\"] <- \"y\"\nvars[\"parents_safe\", \"done\"] <- \"y\"\nvars[\"onway\",        \"done\"] <- \"y\"\nvars[\"time\",         \"done\"] <- \"y\"\nvars[\"stuff\",        \"done\"] <- \"y\"\nvars[\"sched\",        \"done\"] <- \"y\"\nvars[\"planning\",     \"done\"] <- \"y\"\nvars[\"sweaty\",       \"done\"] <- \"y\"\nvars[\"unsafe\",       \"done\"] <- \"y\"\nvars[\"tired\",        \"done\"] <- \"y\"\nvars[\"confd\",        \"done\"] <- \"y\"\nvars[\"desire\",       \"done\"] <- \"y\"\nvars[\"intention\",    \"done\"] <- \"y\"\nvars[\"cool\",         \"done\"] <- \"y\"\nvars[\"friends_dont\", \"done\"] <- \"y\"\nvars[\"friends_say\",  \"done\"] <- \"y\"\nvars[\"parents_say\",  \"done\"] <- \"y\"\nvars[\"TSlike\",       \"done\"] <- \"y\"\nvars[\"weather\",      \"done\"] <- \"y\"\nvars[\"hills\",        \"done\"] <- \"y\"\nvars[\"boring_r\",     \"done\"] <- \"y\"\nvars[\"NEStConnect\",  \"done\"] <- \"y\"\nvars[\"NGEsthetics\",  \"done\"] <- \"y\"\nvars[\"interesting\",  \"done\"] <- \"y\"\nvars[\"pleasant\",     \"done\"] <- \"y\"\nvars[\"boring\",       \"done\"] <- \"y\"\nvars[\"healthy\",      \"done\"] <- \"y\"\nvars[\"useful\",       \"done\"] <- \"y\"\nvars[\"safe\",         \"done\"] <- \"y\"\nvars[\"exercise\",     \"done\"] <- \"y\"\nvars[\"whodecides\",   \"done\"] <- \"y\"\nvars[\"control\",      \"done\"] <- \"y\"\n#v <- vars[-c(1:4,12,15,52:56, 58,59,61,48), ]\n#v <- filter( vars, mod !=\"\") %>% arrange(slot)\nprint( xtable(vars, caption=\"Classification of variables into the Panter et al. framework\", label=\"tab:variables-in-slots\"), booktabs=TRUE, size=\"scriptsize\")\n@\n%\\normalsize\n%\\end{table}\n\n\\clearpage\n\\section{Physical environment}\nWe have very few measures of the environment.\n\n\\subsection{Aspects of the neighbourhood}\nNothing.\n\\subsection{Aspects of the destination}\nNothing.\n\\subsection{Aspects of the route}\n\\subsubsection{\\Sexpr{Hmisc::label(Dist)}}\n\\small\n<<uni_dist, dependson=c(\"read-data\", \"data-setup\"), results='asis'>>=\nuni_dist <- robcov( lrm( W2S ~ Dist, x=T, y=T), School )\nprint( uni_dist, latex=TRUE, title='')\n@\n\\normalsize\n\n\n\\clearpage\n\\section{Individual factors}\n\\subsection{Parental factors}\n\\subsubsection{Parental characteristics}\n\n\\subsubsection{Parental attitudes}\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(parents_say)}}\n\\small\n<<uni_parents_say, dependson=c(\"read-data\", \"data-setup\"), results='asis'>>=\nuni_parents_say_a <- robcov( lrm( W2S ~ parents_say*Dist + parents_say*Sex, x=T, y=T ), School)\nuni_parents_say_b <- robcov( lrm( W2S ~ parents_say*Sex  + parents_say*Age, x=T, y=T ), School)\nprint( uni_parents_say_a, latex=TRUE, title='' )\nprint( uni_parents_say_b, latex=TRUE, title='' )\n@\n\\normalsize\n\n\\paragraph{\\Sexpr{Hmisc::label(parents_safe)}}\n\\small\n<<uni_parents_safe, dependson=c(\"read-data\", \"data-setup\" ), results='asis'>>=\nuni_parents_safe_a <- robcov( lrm( W2S ~ parents_safe*Dist + parents_safe*Sex + parents_safe*Age, x=T, y=T), School)\nprint(uni_parents_safe_a, latex=TRUE, title='' )\n@\n\\normalsize\n\n\n\\clearpage\n\\subsection{Perceptions of the environment}\n\\subsubsection{Parental perceptions}\n\n\\clearpage\n\\subsubsection{Youth perceptions}\n\\paragraph{\\Sexpr{Hmisc::label(onway)}}\n\\small\n<<uni_onway, dependson=c(\"read-data\", \"data-setup\"), results='asis'>>=\nuni.onway.a <- robcov(lrm( W2S ~ onway*Dist + onway*Sex  + onway*Age, x=T, y=T ), School)\nprint( uni.onway.a, latex=TRUE, title='' )\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(time)}}\n\\small\n<<uni_time, dependson=c(\"read-data\", \"data-setup\"), results='asis'>>=\nuni.time.a <- robcov(lrm( W2S ~ time*Dist + time*Sex  + time*Age, x=T, y=T ), School)\nprint(uni.time.a, latex=TRUE, title='' )\n@\n\\normalsize\n\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(weather)}}\n\\small\n<<uni_weather, dependson=c(\"read-data\", \"data-setup\"), results='asis'>>=\nuni.weather.a <- robcov(lrm( W2S ~ weather*Dist + weather*Sex, x=T, y=T), School)\nuni.weather.b <- robcov(lrm( W2S ~ weather*Sex  + weather*Age, x=T, y=T), School)\nprint(uni.weather.a, latex=TRUE, title='' )\nprint(uni.weather.b, latex=TRUE, title='')\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(hills)}}\n\\small\n<<uni_hills, dependson=c(\"read-data\", \"data-setup\"), results='asis'>>=\nuni.hills.a <- robcov(lrm( W2S ~ hills*Dist + hills*Sex+ hills*Age, x=T, y=T ), School)\nprint(uni.hills.a, latex=TRUE, title='' )\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(NEStConnect)}}\n\\small\n<<uni_NEStConnect, dependson=c(\"read-data\", \"data-setup\"), results='asis'>>=\nuni.NEStConnect.a <- robcov(lrm( W2S ~ NEStConnect*Dist + NEStConnect*Sex, x=T, y=T ), School)\nuni.NEStConnect.b <- robcov(lrm( W2S ~ NEStConnect*Sex  + NEStConnect*Age, x=T, y=T ), School)\nprint(uni.NEStConnect.a, latex=TRUE, title='' )\nprint(uni.NEStConnect.b, latex=TRUE, title='' )\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(NGEsthetics)}}\n\\small\n<<uni_NGEsthetics, dependson=c(\"read-data\", \"data-setup\"), results='asis'>>=\nuni.NGEsthetics.a <- robcov(lrm( W2S ~ NGEsthetics*Dist + NGEsthetics*Sex, x=T, y=T ), School)\nuni.NGEsthetics.b <- robcov(lrm( W2S ~ NGEsthetics*Sex  + NGEsthetics*Age, x=T, y=T ), School)\nprint(uni.NGEsthetics.a, latex=TRUE, title='' )\nprint(uni.NGEsthetics.b, latex=TRUE, title='')\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(interesting)}}\n\\small\n<<uni_interesting, dependson=c(\"read-data\"), results='asis'>>=\nuni.interesting.a <- robcov( lrm( W2S ~ interesting*Dist + interesting*Sex, x=T, y=T ), School)\nuni.interesting.b <- robcov( lrm( W2S ~ interesting*Sex  + interesting*Age, x=T, y=T ), School)\nprint(uni.interesting.a, latex=TRUE, title='' )\nprint(uni.interesting.b, latex=TRUE, title='')\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(pleasant)}}\n\\small\n<<uni_pleasant, dependson=c(\"read-data\"), results='asis'>>=\nuni.pleasant.a <- robcov( lrm( W2S ~ pleasant*Dist + pleasant*Sex, x=T, y=T ), School)\nuni.pleasant.b <- robcov( lrm( W2S ~ pleasant*Sex  + pleasant*Age, x=T, y=T ), School)\nprint(uni.pleasant.a, latex=TRUE, title='' )\nprint(uni.pleasant.b, latex=TRUE, title='')\n@\n\\normalsize\n\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(boring)}}\n\\small\n<<uni_boring, dependson=c(\"read-data\"), results='asis'>>=\nuni.boring.a <- robcov( lrm( W2S ~ boring*Dist +  boring*Sex+  boring*Age, x=T, y=T ), School)\nprint(uni.boring.a, latex=TRUE, title='' )\n@\n\\normalsize\n\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(boring_r)}}\n\\small\n<<uni_boring_r, dependson=c(\"read-data\"), results='asis'>>=\nuni.boring_r.a <- robcov(lrm( W2S ~ boring_r*Dist +  boring_r*Sex+  boring_r*Age, x=T, y=T ), School)\nprint(uni.boring_r.a, latex=TRUE, title='' )\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(healthy)}}\n\\small\n<<uni_healthy, dependson=c(\"read-data\"), results='asis'>>=\nuni.healthy.a <- robcov(lrm( W2S ~ healthy*Dist +  healthy*Sex, x=T, y=T ), School)\nuni.healthy.b <- robcov(lrm( W2S ~ healthy*Sex  +  healthy*Age, x=T, y=T ), School)\nprint(uni.healthy.a, latex=TRUE, title='' )\nprint(uni.healthy.b, latex=TRUE, title='')\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(useful)}}\n\\small\n<<uni_useful, dependson=c(\"read-data\"), results='asis'>>=\nuni.useful.a <- robcov(lrm( W2S ~ useful*Dist + useful*Sex, x=T, y=T ), School)\nuni.useful.b <- robcov(lrm( W2S ~ useful*Sex  + useful*Age, x=T, y=T ), School)\nprint(uni.useful.a, latex=TRUE, title='' )\nprint(uni.useful.b, latex=TRUE, title='')\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(safe)}}\n\\small\n<<uni_safe, dependson=c(\"read-data\"), results='asis'>>=\nuni.safe.a <- robcov( lrm( W2S ~ safe*Dist + safe*Sex, x=T, y=T ), School)\nuni.safe.b <- robcov( lrm( W2S ~ safe*Sex  + safe*Age, x=T, y=T ), School)\nprint(uni.safe.a, latex=TRUE, title='' )\nprint(uni.safe.b, latex=TRUE, title='')\n@\n\\normalsize\n\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(exercise)}}\n\\small\n<<uni_exercise, dependson=c(\"read-data\"), results='asis'>>=\nuni.exercise.a <- robcov( lrm( W2S ~ exercise*Dist + exercise*Sex, x=T, y=T ), School)\nuni.exercise.b <- robcov( lrm( W2S ~ exercise*Sex  + exercise*Age, x=T, y=T ), School)\nprint(uni.exercise.a, latex=TRUE, title='' )\nprint(uni.exercise.b, latex=TRUE, title='')\n@\n\\normalsize\n\n\n\\clearpage\n\\subsection{Youth factors}\n\\subsubsection{Youth characteristics}\n\\paragraph{\\Sexpr{Hmisc::label(BMI_f)}}\n\\small\n<<uni_BMI, dependson=c(\"read-data\", \"data-setup\"), results='asis'>>=\nuni.BMI <- robcov( lrm( W2S ~ BMI_f, x=T, y=T ), School)\nprint(uni.BMI, latex=TRUE, title='' )\n@\n\\normalsize\n\n\n\\subsubsection{Youth attitudes}\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(stuff)}}\n\\small\n<<uni_stuff, dependson=c(\"read-data\", \"data-setup\"), results='asis'>>=\nuni.stuff.a <- robcov(lrm( W2S ~ stuff*Dist + stuff*Sex+ stuff*Age, x=T, y=T ), School)\nprint(uni.stuff.a, latex=TRUE, title='' )\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(sched)}}\n\\small\n<<uni_sched, dependson=c(\"read-data\"), results='asis'>>=\nuni_sched_a <- robcov(lrm( W2S ~ sched*Dist  + sched*Age+ sched*Sex, x=T, y=T ), School)\nprint(uni_sched_a, latex=TRUE, title='')\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(planning)}}\n\\small\n<<uni_planning, dependson=c(\"read-data\"), results='asis'>>=\nuni_planning <- robcov( lrm( W2S ~ planning*Dist + planning*Age + planning*Sex, x=T, y=T ), School)\nprint(uni_planning, latex=TRUE, title='')\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(sweaty)}}\n\\small\n<<uni_sweaty, dependson=c(\"read-data\"), results='asis'>>=\nuni_sweaty <- robcov( lrm( W2S ~ sweaty*Dist + sweaty*Age + sweaty*Sex, x=T, y=T ), School)\nprint(uni_sweaty, latex=TRUE, title='')\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(unsafe)}}\n\\small\n<<uni_unsafe, dependson=c(\"read-data\"), results='asis'>>=\nuni_unsafe <- robcov( lrm( W2S ~ unsafe*Dist + unsafe*Age + unsafe*Sex, x=T, y=T ), School)\nprint(uni_unsafe, latex=TRUE, title='')\n@\n\\normalsize\n\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(tired)}}\n\\small\n<<uni_tired, dependson=c(\"read-data\"), results='asis'>>=\nuni_tired_a <- robcov(lrm( W2S ~ tired*Dist + tired*Sex+ tired*Age, x=T, y=T ), School)\nprint(uni_tired_a, latex=TRUE, title='')\n@\n\\normalsize\n\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(desire)}}\n\\small\n<<uni_desire, dependson=c(\"read-data\"), results='asis'>>=\nuni_desire <- robcov( lrm( W2S ~ desire*Dist + desire*Age + desire*Sex, x=T, y=T ), School)\nprint(uni_desire, latex=TRUE, title='')\n@\n\\normalsize\n\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(confd)}}\n\\small\n<<uni_confd, dependson=c(\"read-data\"), results='asis'>>=\nuni_confd_a <- robcov(lrm( W2S ~ confd*Dist + confd*Sex, x=T, y=T ), School)\nuni_confd_b <- robcov(lrm( W2S ~ confd*Sex  + confd*Age, x=T, y=T ), School)\nprint(uni_confd_a, latex=TRUE, title='')\nprint(uni_confd_b, latex=TRUE, title='')\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(intention)}}\n\\small\n<<uni_intention, dependson=c(\"read-data\"), results='asis'>>=\nuni_intention_a <- robcov( lrm( W2S ~ intention*Dist + intention*Sex, x=T, y=T ), School)\nuni_intention_b <- robcov( lrm( W2S ~ intention*Sex + intention*Age, x=T, y=T ), School)\nprint(uni_intention_a, latex=TRUE, title='')\nprint(uni_intention_b, latex=TRUE, title='')\n@\n\\normalsize\n\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(school_says)}}\n\\small\n<<uni_school_says, dependson=c(\"read-data\"), results='asis'>>=\nuni_school_says_a <- robcov(lrm( W2S ~ school_says*Dist + school_says*Sex + school_says*Age, x=T, y=T ), School)\nprint(uni_school_says_a, latex=TRUE, title='')\n@\n\\normalsize\n\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(cool)}}\n\\small\n<<uni_cool, dependson=c(\"read-data\"), results='asis'>>=\nuni_cool <- robcov( lrm( W2S ~ cool*Dist + cool*Age + cool*Sex, x=T, y=T ), School)\nprint(uni_cool, latex=TRUE, title='')\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(friends_dont)}}\n\\small\n<<uni_friends_dont, dependson=c(\"read-data\"), results='asis'>>=\nuni_friends_dont <- robcov( lrm( W2S ~ friends_dont*Dist + friends_dont*Age + friends_dont*Sex, x=T, y=T ), School)\nprint(uni_friends_dont, latex=TRUE, title='')\n@\n\\normalsize\n\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(TSlike)}}\n\\small\n<<uni_TSlike, dependson=c(\"read-data\"), results='asis'>>=\nuni_TSlike <- robcov( lrm( W2S ~ TSlike*Dist + TSlike*Age + TSlike*Sex, x=T, y=T ), School)\nprint(uni_TSlike, latex=TRUE, title='')\n@\n\\normalsize\n\n\\clearpage\n\\subsection{The decision process}\n\\subsubsection{\\Sexpr{Hmisc::label(whodecides)}}\n\\small\n<<uni_whodecides, dependson=c(\"read-data\"), results='asis'>>=\nuni_whodecides <- robcov( lrm(W2S ~ whodecides*Dist + whodecides*Age + whodecides*Sex, x=T, y=T), School)\nprint(uni_whodecides, latex=TRUE, title='')\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{\\Sexpr{Hmisc::label(control)}}\n\\small\n<<uni_control, dependson=c(\"read-data\"), results='asis'>>=\nuni_control_a <- robcov( lrm( W2S ~ control*Dist + control*Sex+control*Age, x=T, y=T ), School)\nprint(uni_control_a, latex=TRUE, title='')\n@\n\\normalsize\n\n\\section{External factors}\nWe do not have any measures of external factors as described by Panter et al.\n\n\\clearpage\n\\section{Other factors}\nThese are factors that don't obviously fit into one of the categories described\nby Panter et al.\n\n\\subsection{\\Sexpr{Hmisc::label(regwalk)}}\n<<uni_regwalk, dependson=c(\"read-data\"), results='asis'>>=\nuni_regwalk <- robcov( lrm( W2S ~ Dist + regwalk, x=T, y=T ), School)\nprint(uni_regwalk, latex=TRUE, title='')\n@\n\n\n\\clearpage\n\\subsection{\\Sexpr{Hmisc::label(schiclose)}}\n<<uni_schiclose, dependson=c(\"read-data\"), results='asis'>>=\nuni_schiclose <- robcov( lrm( W2S ~ Dist + schiclose, x=T, y=T ), School)\nprint(uni_schiclose, latex=TRUE, title='')\n@\n\n\n\n\\clearpage\n\\section{Multivariate models}\n\\label{sec:multivariate}\n\\subsection{Physical Environment}\n<<block_1, results=\"asis\", dependson=\"data-setup\">>=\nmult_block_1 <- robcov( lrm( W2S ~ Dist, x=T, y=T ), School)\nprint(mult_block_1, latex=TRUE, title='Block 1')\n@\n\n\\clearpage\n\\subsection{Individual Factors}\n\\subsubsection{Parental factors}\n\nWhen \\texttt{parents\\_safe} was added to Block 1, the interaction term with\nDistance was not significant, and was hence removed.\n\n<<block_2, results='asis', dependson=\"block_1\">>=\ndat.ats <- dat.ats[ complete.cases(dat.ats$W2S, dat.ats$Dist, dat.ats$School\n    , dat.ats$parents_safe, dat.ats$parents_say, dat.ats$sched, dat.ats$boring, dat.ats$planning, dat.ats$pleasant\n    #, dat.ats$NGEsthetics\n    ), ]\ndd <- datadist(dat.ats)\noptions(datadist=\"dd\")\ndetach(dat.ats)\nattach(dat.ats)\n\nmult_block_2 <- robcov(  update(mult_block_1, . ~ . + parents_safe*Sex), School)\nprint(mult_block_2, latex=TRUE, title='Block 2')\n@\n\nThere are \\Sexpr{mult_block_1$stats[\"Obs\"] - mult_block_2$stats[\"Obs\"] } fewer\ncases in this model because of missing values for \\texttt{parents\\_safe}. The\nlikelihood ratio test shows that this model has significantly less deviance than\nthe previous model.The $C$ index, i.e. area under the ROC, is\n\\Sexpr{ fmt(mult_block_1$stats[\"C\"], 3) } for Block 1\nvs.\n\\Sexpr{ fmt(mult_block_2$stats[\"C\"], 3) } for Block 2.\n\n\n<<m1m2-test, dependson=c(\"block_1\", \"block_2\")>>=\noptions(digits=2)\nlrtest(mult_block_1, mult_block_2)\n@\n\n\n\\clearpage\n\\subsubsection{Perceptions of the environment}\nThere was a dramatic reduction in sample size due to the large number of missing\nvalues for \\texttt{NGEsthetics} (down to $n=975$), however neither the main\neffect of that variable nor any of its moderators were significant, hence it was\nremoved and the model was run again. Terms that were no longer significant in\nthis block are \\texttt{interesting} and its moderators, and \\texttt{boring*Dist}.\n\n<<block_3, results='asis', dependson=c(\"block_2\")>>=\ndetach(dat.ats)\nattach(dat.ats)\nmult_block_3 <- robcov( update(mult_block_2, . ~ .\n                               + hills*Dist\n                               + weather\n                               + pleasant*Sex\n                                ),  School)\nprint(mult_block_3, latex=TRUE, title='Block 3')\n@\n\nThe $C$ index is\n\\Sexpr{ fmt(mult_block_2$stats[\"C\"], 3) } for Block 3\nvs.\n\\Sexpr{ fmt(mult_block_3$stats[\"C\"], 3) } for Block 3, and the likelihood ratio\ntest confirms the reduction in deviance is significant.\n\n\\small\n<<m2m3-test, dependson=c(\"block_3\")>>=\noptions(digits=2)\nlrtest( mult_block_2, mult_block_3)\n@\n\\normalsize\n\n\\clearpage\n\\subsubsection{Youth factors}\n\\paragraph{Characteristics}\nBMI\n\n\\footnotesize\n<<block-3.5, dependson=c(\"block_3\"), results='asis'>>=\nattach(dat.ats)\nmult_block_4 <- robcov( update(mult_block_3, . ~ . + BMI_f))\nprint(mult_block_4, latex=TRUE, title='Block 4')\n@\n\\normalsize\n\n\\clearpage\n\\paragraph{Attitudes}\n\n<<block_4, results='asis', dependson=c(\"block_3\")>>=\n# Had to remove boring*Age, desire*Age\ndetach(dat.ats)\nattach(dat.ats)\nmult_block_5 <- robcov( update(mult_block_3, . ~ .\n   + desire*Age\n   - hills:Dist - hills\n   - weather\n  ),\n  School)\nprint(mult_block_5, latex=TRUE, title='Block 5')\n@\n\n\nThe $C$ indices are\n\\Sexpr{ fmt(mult_block_3$stats[\"C\"], 3) } for Block 3\nvs.\n\\Sexpr{ fmt(mult_block_5$stats[\"C\"], 3) } for Block 5. The likelihood ratio\ntest cannot be performed because the models are not nested.\n%confirms the difference is significant.\n\n\\small\n<<m3m4-test, dependson=c(\"block_3\", \"block_4\")>>=\n#options(digits=2)\n#lrtest(mult_block_3, mult_block_5)\n@\n\\normalsize\n\n\\clearpage\n\\subsection{The decision process}\n\n<<block_6, results='asis', dependson=c(\"block_4\")>>=\ndetach(dat.ats)\nattach(dat.ats)\nmult_block_6 <- robcov( update(mult_block_5, . ~ . + control*Sex), School )\nprint(mult_block_6, latex=TRUE, title='Block 6')\n@\n\n\n\\footnotesize\n<<m4m5-test, dependson=c(\"block_4\", \"block_5\")>>=\noptions(width=80, digits=3)\nlrtest(mult_block_5, mult_block_6)\n@\n\\normalsize\nThe likelihood ratio test is significant, and the\ndifference is substantial (e.g. the $C$ indices\n\\Sexpr{ fmt(mult_block_4$stats[\"C\"], 3) } for Block 5\nvs.\n\\Sexpr{ round(mult_block_6$stats[\"C\"], 3) } for Block 6.\n\n\n\\clearpage\n\\subsection{Other factors}\n\n\\footnotesize\n<<block_7, results='asis', dependson=c(\"block_6\")>>=\ndat.ats <- dat.ats[complete.cases((dat.ats$regwalk)), ]\ndd <- datadist(dat.ats)\noptions(datadist=\"dd\")\ndetach(dat.ats)\nattach(dat.ats)\n\nmult_block_7a <- robcov( update( mult_block_6, . ~ . + regwalk\n                                - control:Sex\n                                - desire:Age -Age), School)\nmult_block_7b <- robcov( lrm( W2S ~ rcs(Dist, 3) + parents_safe*Sex + pleasant*Sex + desire + control + regwalk, x=T, y=T), School)\nprint(mult_block_7a, latex=TRUE, title='Block 7a')\nprint(mult_block_7b, latex=TRUE, title='Block 7b')\n@\n\\normalsize\n\n\\footnotesize\n% , results='asis'\n<<fm>>=\n#latex(summary(mult_block_7), file='')\nsummary(mult_block_7b)\n@\n\\normalsize\n\nThe likelihood ratio test is significant, and in  substantive terms the\ndifference is also significant (e.g. the $C$ indices\n\\Sexpr{ fmt(mult_block_6$stats[\"C\"]) } for Block 6\nvs.\n\\Sexpr{ fmt(mult_block_7b$stats[\"C\"]) } for Block 7b).\n\n\\small\n<<final-test, dependson=c(\"block_6\", \"block_7\")>>=\noptions(digits=2)\nlrtest( mult_block_6, mult_block_7b )\nmult_final <- mult_block_7b\n@\n\n\n\\clearpage\n\\section{The final model}\nSummary:\n<<fm_sum, dependson=\"final-test\">>=\nLR.summary( mult_final  )\n@\n\nExpressed as \\textit{simple} odds ratios (i.e. non-comparable):\n\n<<fm-OR, dependson=\"final-test\">>=\n#OR( mult_final, \"dd\")\nexp(coef(mult_final))\n@\n\n\\clearpage\n\\section{Summary}\nThe final model should be compared with the final model developed by me, using\nthe opposite approach, i.e. entering all potential covariates first and then\nremoving them one-by one.\n\n\\begin{center}\n\\begin{tabular}{lllll}\n\\toprule\nVariable     & JW & JS \\\\\n\\midrule\nDistance     & y  & y \\\\\nregwalk      & y  & y \\\\\n\\midrule\npleasant     & n  & y \\\\\ndesire       & n  & y \\\\\ncontrol      & n  & y \\\\\nSex          & n  & y \\\\\nparents safe & n  & y \\\\\n\\midrule\nparents say  & y  & n \\\\\nBMI          & y  & n \\\\\nonway        & y  & n \\\\\nsched        & y  & n \\\\\nplanning     & y  & n \\\\\ncool         & y  & n \\\\\n\\bottomrule\n\\end{tabular}\n\\end{center}\n\nWe can see that the models are very dissimilar. This happens when there is\nmulticollinearity, and when a small number of variables have very large effects,\nand the rest of the effects are relatively small. Standard diagnostic tests\n(i.e. examination of VIFs did not indicate excessive multicollinearity), but the\npossiblility remains, as many of the IVs have at least moderate correlation.\n\nBut because the results obtained depend on the order in which variables are\nentered or removed, only tentative conclusions should be drawn at this stage.\nTo me, the overwhelming effect is the---somewhat theoretically trivial---effect\nof being a walker for general mobility.  All other effects should be interpreted\nwith caution, and substantiated by additional analysis, if possible.\n\nHowever a crucial difference in the modelling, apart from the order effect, is\nthe use of interaction terms in John Spence's approach. However this is\nnon-trivial to implement in a step-down procedure, as the huge number of\nterms in a single model leads almost invariably to numerical problems.\n\nThese issues are, unfortuately, part and parcel of social science modelling:\nlarge measurement error compounding the curse of dimensionality.\n\nOne way to address this problem is to compare the models based on explanatory\npower, either by information measures (AIC, BIC), classification measures\n(the $C$ index (AUC) or correlational measure of estimates with true values\n($R^2$ or $\\tau_a$). (I wrote this before I conducted the comparison, so I can\ntruly claim to be unbiased.)  The results are:\n\n<<make-comparisons>>=\nJW <- robcov(lrm(W2S ~ rcs(Dist, 3) + BMI_f\n          + onway + sched + planning\n          + parents_say + cool + regwalk,\n          x=T, y=T), cluster=School )\nJW_AIC <- fmt(AIC(JW),0)\nJW_BIC <- fmt(BIC(JW),0)\n\nJS_AIC <- fmt(AIC(mult_final),0)\nJS_BIC <- fmt(BIC(mult_final),0)\n@\n\n\\begin{center}\n\\begin{tabular}{lrrc}\n\\toprule\nCriterion & JW & JS & Better \\\\\n\\midrule\nAIC       & \\Sexpr{JW_AIC}                 & \\Sexpr{JS_AIC}   & JW\\\\\nBIC       & \\Sexpr{JW_BIC}                 & \\Sexpr{JS_BIC}   & JW\\\\\n$R^2$     & \\Sexpr{fmt(JW$stats[\"R2\"])}    & \\Sexpr{fmt(mult_final$stats[\"R2\"])}    & JW \\\\\n$\\tau_a$  & \\Sexpr{fmt(JW$stats[\"Tau-a\"])} & \\Sexpr{fmt(mult_final$stats[\"Tau-a\"])} & JW \\\\\n$C$       & \\Sexpr{fmt(JW$stats[\"C\" ])}    & \\Sexpr{fmt(mult_final$stats[\"C\" ])}    & JW \\\\\nBrier     & \\Sexpr{fmt(JW$stats[\"Brier\"])} & \\Sexpr{fmt(mult_final$stats[\"Brier\"])} & -- \\\\\n\\bottomrule\n\\end{tabular}\n\\end{center}\n\nMy model is better on all measures, \\emph{statistically}, however the JS model\nmay be superior on theoretical grounds. I do not have the knowlwedge to make\nthis judgement, however.\n\n\\end{document}\n\n",
    "created" : 1437463628556.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "725818383",
    "id" : "6F1CE2AE",
    "lastKnownWriteTime" : 1438219301,
    "path" : "~/Dropbox/Research/Collaboration/BEATS/John/Analysis/Correlates of ATS/Model search/Model_search.Rnw",
    "project_path" : "Model search/Model_search.Rnw",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "sweave"
}